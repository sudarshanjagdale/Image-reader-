let csvData = "Document ID,Pages,Layout,Usage Rule,Source\n";
let currentPage = 1;
let totalPages = 184; // Update if needed
let delay = 40000; // 40 seconds wait for page to load

async function extractAllPages() {
    while (currentPage <= totalPages) {
        console.log(`üìÑ Extracting page ${currentPage}...`);

        // Wait for page to load
        await new Promise(resolve => setTimeout(resolve, delay));

        let rows = document.querySelectorAll("table tbody tr");
        rows.forEach(row => {
            let cells = row.querySelectorAll("td");
            let rowData = Array.from(cells).map(td => `"${td.innerText.trim()}"`).join(",");
            csvData += rowData + "\n";
        });

        // Try clicking the next page button
        let nextBtn = Array.from(document.querySelectorAll("button"))
            .find(btn => btn.textContent.includes("‚Ä∫") || btn.getAttribute("aria-label")?.includes("Next"));

        if (!nextBtn || nextBtn.disabled) {
            console.log("‚ùå No more pages or Next button not found.");
            break;
        }

        nextBtn.click();
        currentPage++;
    }

    // Download CSV file
    let blob = new Blob([csvData], { type: 'text/csv' });
    let url = URL.createObjectURL(blob);
    let link = document.createElement("a");
    link.href = url;
    link.download = "hyperscience_training_data_all_pages.csv";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    console.log("‚úÖ CSV downloaded with all pages.");
}

extractAllPages();